machine:
  services:
    - docker

dependencies:
  override:
    - $(aws ecr get-login --region us-east-1)
    - docker build -t finliv-backend .

test:
  override:
    - echo "test"

deployment:
  hub:
    branch: master ## do deployment on commit to the master branch only 
    commands:
      - docker tag finliv-backend 952029690192.dkr.ecr.us-east-1.amazonaws.com/finliv/finliv-backend:$CIRCLE_SHA1
      - docker tag finliv-backend 952029690192.dkr.ecr.us-east-1.amazonaws.com/finliv/finliv-backend:latest
      - docker push 952029690192.dkr.ecr.us-east-1.amazonaws.com/finliv/finliv-backend:$CIRCLE_SHA
      - docker push 952029690192.dkr.ecr.us-east-1.amazonaws.com/finliv/finliv-backend:latest
      - ./deploy.sh